---
layout: post
title: "Ishihara plates generated by Monte Carlo algorithms"
date: 2016-02-19
categories:
  - Coding
description: 
image: https://raw.githubusercontent.com/icfaust/icfaust.github.io/master/_screenshots/Beast_Ishihara.png
image-sm: https://raw.githubusercontent.com/icfaust/icfaust.github.io/master/_screenshots/Beast_Ishihara.png
---


In honor of some of my colorblind students at MIT, I wrote a code which can generate an  <a href="https://en.wikipedia.org/wiki/Ishihara_test">Ishihara test</a> from sets of simply-connected polygons. The outcome is a working example of the <a href="http://web.mit.edu/beast/www/">'Beast'</a> hall symbol.

This required the following:

<ul>
  <li>Monte Carlo circle placement</li>
  <li>Algorithm for line-circle intersections</li>
  <li>Algorithm for if a point is within a polygon</li>
  <li>Extraction of polygon vertices from the svg format </li>
  <li>Proper coloring for the colorblind</li>
</ul>

<h3>Monte Carlo circle placement</h3>

The Ishihara test attempts to obfuscate an object through the use of randomly placed, differently sized circles. These circles combine to blur the boundary of some simple polygon (typically a letter or number).  Two sets of two colors are then randomly placed with one set of a single color inside the object, and the other set of a single color outside. Usually this is a dark and light red, and then a dark and light green.  Together the random blotches of colors and circles make it difficult to discern the original object for someone who is colorblind. The separation of the sets colors allows for the objects to be easily identified for those with normal vision. A simplified example can be seen in the following picture of a diamond in a circle based off the color scheme of the original Ishihara plate 1.

<figure>
  <img src="https://raw.githubusercontent.com/icfaust/icfaust.github.io/master/_screenshots/testout2.gif" alt="Placeholder"/>
</figure>

Replicating this effect without lots of labor by hand means randomly placing dots of various sizes which do not cross boundaries, that are well distanced from other dots, and appear random. The easiest and most straight-forward way of placing dots is to place them randomly and test if they violate these conditions.  This simple <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Monte Carlo method</a> rests on being able to create an array of valid dots and polygon lines which are compared to the next random dot. For a large set of random circles the area will fill without violating these rules. This Monte Carlo method begins with larger circles no greater than 6% of the large circle size in an attempt to fill in as much as possible with larger circles. Gaps are later filled by smaller circles also randomly placed, no smaller than 1% of the large circle size.  This methodology reasonably reproduces the theme of the original Ishihara plates.   

<h3>Line-circle intersections</h3>

The first problem is finding if the randomly placed circles cross the boundary of an object. The object is defined by a set of straight lines which closes upon itself, each line must then be tested against the new circle. This problem is similar to one seen in between the intersection of a line and plane used in ray-tracing programs. Solving for the <a href="https://en.wikipedia.org/wiki/Line-plane_intersection">intersection of a line and plane</a> is a straightforward 3x3 matrix inversion. In two dimensions it is the intersection of two lines. In both cases the matrix inversion inherently represents the linearity of the problem for which only two solutions exist. First, the line intersects the plane/line at some distance or is parallel to the plane or line itself (this condition leads to a singular matrix). 

Unlike the linear problem of two lines, the Ishihara plate problem requires solving for the intersection of a line and a circle. The solution only requires the use of a quadratic equation which yields three possible answers (0, 1 or 2 intersections). Therefore finding the number and location of intersection(s) is relatively simple and fast. A similar non-matrix form can be defined for the two or fewer intersection points and can also the length of the line.

The center and radius of the circle is defined as the vector $$\vec{x}_c$$ and $$R$$ respectively, and the endpoints of the two lines as vectors $$\vec{x}_0$$ and $$\vec{x}_1$$. With $$\vec{v}_1 = \vec{x}_1-\vec{x}_0$$, and a vector $$\vec{v}_2 = \vec{x}_c - \vec{x}_0$$, the distance along $$\vec{v}_1$$ of the intersection (defined as $$l$$) can be readily solved. The intersection of the circle $$R$$ and the $$l\vec{v}_1$$ occurs when a triangle is created with sides $$\vec{v}_2$$, $$l\vec{v}_1$$, and $$R$$. $$R$$ can be defined from a vector subraction and a dot product with itself.

$$\vec{R} = l\vec{v}_1-\vec{v}_2$$

$$R^2 = (lv_1)^2+v_2^2-2l\vec{v}_1\cdot\vec{v}_2$$

This equation is quadratic in $$l$$, and can be readily solved for.  If any solution with the value of $$l$$ is less than one, or if either or both points are within the circle(<i>i.e.</i> $$(\vec{x}_c - \vec{x}_1)^2 < R^2)$$ or $$(\vec{x}_c - \vec{x}_2)^2 < R^2)$$) the circle is removed. This test must be ran for every line which defines the object. An easier proceedure exists to compare the set of 'good' circles, by comparing the distance between centers to the sum of the two radii and some minimum separation distance ($$\sqrt{(\vec{x}_{c2}-\vec{x}_{c1})^2} > R_1+R_2+\epsilon$$).


<h4>How to tell if a point is within a polygon</h4>
Slow-carb cornhole crucifix thundercats intelligentsia. Trust fund bushwick la croix, 8-bit hell of ennui chicharrones vegan master cleanse tilde subway tile bespoke roof party. Next level celiac bushwick coloring book subway tile. Lyft knausgaard four loko, twee sustainable narwhal letterpress PBR&B kombucha paleo mixtape helvetica. Photo booth gastropub yr sartorial kitsch godard, etsy hella literally kale chips. Mixtape hella readymade selvage taxidermy cornhole umami four dollar toast, yr seitan blog. Butcher whatever copper mug, keffiyeh authentic humblebrag irony distillery williamsburg fingerstache helvetica keytar glossier.

<figure>
  <img src="https://unsplash.it/2000/1200?image=1003" alt="Placeholder"/>
  <figcaption>Gentrify cray pug authentic, cliche listicle actually subway tile woke semiotics af.</figcaption>
</figure>

Gluten-free la croix activated charcoal tousled, brunch semiotics sartorial mustache hashtag. Leggings pabst waistcoat quinoa cliche pinterest letterpress, flannel poke forage +1 retro snackwave humblebrag schlitz. Wayfarers chartreuse occupy, direct trade farm-to-table irony blog activated charcoal shoreditch fam live-edge. Intelligentsia scenester gochujang gentrify portland offal. Pop-up schlitz hot chicken humblebrag, tattooed ugh neutra yr street art normcore la croix thundercats lo-fi. Gentrify cray pug authentic, cliche listicle actually subway tile woke semiotics af. Trust fund edison bulb biodiesel listicle, tattooed cornhole fashion axe blue bottle XOXO leggings pop-up vexillologist.

Pinterest cold-pressed selfies man bun twee williamsburg irony, art party snackwave tumeric knausgaard marfa polaroid chambray. PBR&B semiotics selvage brooklyn hexagon cray. Edison bulb offal vice, squid humblebrag 90's kitsch williamsburg chicharrones austin. Poke 3 wolf moon selfies banh mi farm-to-table raclette. +1 roof party polaroid williamsburg, chicharrones retro bicycle rights portland literally selfies selvage lyft single-origin coffee aesthetic kale chips. Blog yr la croix four loko beard. Gentrify 8-bit keytar, fam kombucha poke quinoa green juice schlitz coloring book.
